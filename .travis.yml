sudo: false
dist: bionic
language: python
cache: pip

services:
- docker

python:
- 2.7
- 3.5
- 3.6
- 3.7
- 3.8
- pypy3

jobs:
  allow_failures:
  - python: pypy3

before_install:
- docker pull pwntr/samba-alpine
- pip install -U -r ci/requirements.txt

install:
- pip install .[dev,test]

script:
- python -m unittest discover -vv

after_script:
- codecov

before_deploy:
- python setup.py sdist bdist_wheel
- twine check dist/*

deploy:
  provider: script
  script: twine upload --skip-existing dist/*
  skip_cleanup: true
  on:
    python: 3.8
    tags: true
    repo: althonos/fs.smbfs

notifications:
  email:
  - althonosdev@gmail.com
